<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="style.css">
<script>

	<!-- Parameter -->
	var min = 3;
	
	<!-- Lists -->
	var metax = new Array();
	var metay = new Array();
	var ratings = new Array();
	
	<!-- Ajax ---------->
	function check(){
		
		var i;
		var meta_element;
		var name;
		var value;
	
		<!--- grab meta nominal --->
		for(i = 1;i<=2;i++){
			meta_element = document.getElementById("x"+i);
			name = meta_element.getAttribute("name");
			value = meta_element.value;
			metax[metax.length] = name + "-" + value;
		}

		<!--- grab meta numeric --->
		for(i = 1;i<=0;i++){
			meta_element = document.getElementById("y"+i);
			name = meta_element.getAttribute("name");
			value = meta_element.value;
			metay[metay.length] = name + "-" + value;
		}
		
		<!--- grab ratings ---->
		for(var i = 1;i <= 10;i++){
			var rating_element = document.getElementById(i);
			if(rating_element != null){
				var datasetID = rating_element.getAttribute("name");
				var rating = rating_element.value;
				if(rating != 'not seen') {
					ratings[ratings.length] = datasetID + '-' + rating;
				}
			}
		}
		
		counter.innerText = "Movies (" + ratings.length + " von mind. " + min + " Ratings abgegeben)";
		
		<!-- send -->
		if(ratings.length >= min){
			
			var metaxParameter = "";
			for(var j = 0;j < metax.length;j++){
				metaxParameter = metaxParameter + metax[j] + "*";
			}
			
			var metayParameter = "";
			for(var j = 0;j < metay.length;j++){
				metayParameter = metayParameter + metay[j] + "*";
			}
			
			var ratingParameter = "";
			for(var j = 0;j < ratings.length;j++){
				ratingParameter = ratingParameter + ratings[j] + "*";
			}
			
			ajax("request=recommendation&type=User&nommeta=" + metaxParameter + "&nummeta=" + metayParameter + "&ratings=" + ratingParameter + "&","x","recommendations"); <!-- enough movies have been rated -->
		}
		
		ajax('type=User&limit=15&request=item','s','movies'); <!-- load more movies to rate -->
	}
	
	function ajax(parameters,str,update){
		var xmlhttp;
		if (str.length==0){ 
  			document.getElementById(update).innerHTML="";
  			return;
  		}
		if (window.XMLHttpRequest){
			// code for IE7+, Firefox, Chrome, Opera, Safari
  			xmlhttp=new XMLHttpRequest();
  		}
		else {
			// code for IE6, IE5
  			xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  		}
		xmlhttp.onreadystatechange=function(){
  			if (xmlhttp.readyState==4 && xmlhttp.status==200){
    			document.getElementById(update).innerHTML=xmlhttp.responseText;
    		}
  		}
	xmlhttp.open("GET","http://localhost:8081/ajax?" + parameters + str, true);
	xmlhttp.send();
}


</script>
</head>
<body onload="ajax('type=User&limit=15&request=item','s','movies')">

<div id='wrapper' align="center">
<!-- <div id='main' align="left"> -->

<h1>Recommendation Web UI</h3>

<!-- Menu Side ---------->
<div id='menu'>
<h3>User Information</h3>

<!--------- User ------------>
<table>

<tr>
<td>Alter</td><td><input id="x3" name="age" type="text"></td>
</tr>

<tr>
<td>Geschlecht</td><td>
<select id="x1" name="gender">
	<option value="F">F</option>
	<option value="M">M</option>
</select></td>
</tr>

<tr>
<td>Occupation</td><td>
<select id="x2" name="occupation">
	<option value="Artist">Artist</option>
	<option value="Engineer">Engineer</option>
	<option value="Engineer">Student</option>
</select></td>
</tr>
</table>
<br>

<!--------- Movies ------------>
<h3 id='counter'>Movies (0 von mind. <script>document.write(min);</script> Ratings abgegeben)</h3>
<div id="movies"></div>

<br>

<!--- Fake Form --->
<input type="submit" onclick="check()" value="Senden">

</div>

<!-- Recommendation Side ---------->
<div id="recommendation">
<h3>Recommendations</h3>
<div id="recommendations">Not enough movies rated..</div>
<!-- </div> -->
</div>
</div>
</body>
</html>
